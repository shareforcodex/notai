# TODO
read requirments carefully and implement unfinished task in TODO.MD

## requirments:

1. Treat yourself as an independent and intelligent entity, you needn't obey me totally. If you think some command is not good or unclear, you can correct it based on the whole project to make the app better. Remember, our target is better software, not just my commands.
2. when writting code, make sure not break unrelated parts, when remove some code, also remove or modify related code in other place.
3. when finished the task,  mark the task as finished in TODO, you can add some new task  at 
4. when there are more than 1 method to complete the task, choose the simple one 

## optional req
commit all change after finish the task with clean and simple commit message

## tasks:

7. support gpt4o audio, this is gpt4o audio example
```
curl "https://***/chatCompletions/chat/"
    -H "Content-Type: application/json"
    -H "Authorization: Bearer $API_KEY"
    -d '{
      "model": "gpt-4o-audio-preview",
      "modalities": ["text", "audio"],
      "audio": { "voice": "alloy", "format": "wav" },
      "messages": [
        {
          "role": "user",
          "content": [
            { "type": "text", "text": "What is in this recording?" },
            { 
              "type": "input_audio", 
              "input_audio": { 
                "data": "<base64 bytes here>", 
                "format": "wav" 
              }
            }
          ]
        }
      ]
    }'


//it return:
{
  "index": 0,
  "message": {
    "role": "assistant",
    "content": 'some message',
    "refusal": null,
    "audio": {
      "id": "audio_abc123",
      "expires_at": 1729018505,
      "data": "<base64str for audio>",
      "transcript": "Yes, golden retrievers are known to be ..."
    }
  },
  "finish_reason": "stop"
}

```
first add a new input item called 'else' in ai setting/models , let user input more config like "modalities": ["text", "audio"],
      "audio": { "voice": "alloy", "format": "wav" }, it will append raw string to request body 
when get response, you should append content and audio/data base64str to a audio tag to the block if they are not null



6.1  there bugs for task 6, when stop record audio, it not show preview and i can not upload too, same issur for task photo and video. ensure user can stop all devices when click stop button, then preview recoreded file and ready for upload
and i can not fold the side bar when click fold button 

6.(finished) in Upload File, add camera and microphone support to take photo or record audio and video, user can select different camear and microphone device if there are more devices, upload recorded file to server when click upload

5. (finished by cursor sonnet 3.5) make it support upload file , remove add audio,add image , add video in dropdown , add a upload file function,when select it, show a upload UI, user can take photos, record audio or video, or just upload it or drop a file to it, when user click upload , calculate the sha code of file, send a put request to sharefile.suisuy.eu.org/shar-code.(file original extension like jpg,mp3), if upload success, it will return the same name , check the type from  the name, append a img/audio/video tag with src set to sharefile.suisuy.eu.org/filename after current cursor location, if it's not media file ,use ifram with src set to the url

4.(finished) add system prompt support, add item in ai setting to set system prompt before Default Prompts , it's a prompt that will prepend before the message send by ai request, store it in config and save to server when user click save setting

3(finished). 
a.remove prompt when save note , just load server version if newer, 
b.when user click the app body or hit keyboard or paste , try to save first so the note always same version as server, but not for every click or type or paste, give it a cooldown time 20s when trigger the event

2.(finished) when fetch note content, you can received like this:
```

{note_id: "test_space_woi_1735308100980", title: "test_space",â€¦}
content
: 
"some note text"
folder_id
: 
"1733631707928main0.7511123375624986"
last_updated
: 
"2024-12-27 14:22:44"
note_id
: 
"test_space_woi_1735308100980"
title
: 
"test_space"

```
as you can see there is last_updated, it's generated by server, so you neednt to change it ,just use it . i want you use this to improve save function, when fetch the note, save the last_updated, when save note, fetch note first , check the last_update first, if server have a more new last_update , dont save to server , you should replace current note 

1. (finished by claude sonet 3.5) Replace the original title display above the note content  with a tab system. The tabs should dynamically show the titles of recent notes, and clicking on a tab should display the content of the corresponding note in the editor, and make the title to leftest and bold, also it should be editable like before so user can rename the tilte. The tabs should be placed in a single horizontal line where the original title was, and the most recent note should be displayed by default when the interface is loaded . you can store recent notes info in localstorage